<html>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    function fetchOffers()
    {
        var id = $("#id").val();
        if(!id) {
            fetch('/offers')
            .then(response => response.json())
            .then(data => {
             for(datum in data.data) {
                   var htmlObj = data.data[datum].Offer;
                   var link = data.data[datum].TrackingLink.click_url;
                   if(!link) {
                    $('#offer').append("<tr><td>"+htmlObj.id+"</td><td>"+htmlObj.name+"</td><td id="+htmlObj.id+"><button onClick=genTrack("+htmlObj.id+")>Generate Tracking Link</button></td></tr>");  
                   } else {
                      $('#offer').append("<tr><td>"+htmlObj.id+"</td><td>"+htmlObj.name+"</td><td><a href="+link+" target=_blank>"+link+"</a></td></tr>");  
                   }
                   
             }
            });

        } else {
            fetch('/offers/'+id)
            .then(response => response.json())
            .then(data => {
             var htmlObj = data.data.Offer;
             var link = data.data.TrackingLink.click_url;
             if(!link) {
                    $('#offer').append("<tr><td>"+htmlObj.id+"</td><td>"+htmlObj.name+"</td><td id="+htmlObj.id+"><button onClick=genTrack("+htmlObj.id+")>Generate Tracking Link</button></td></tr>");  
            } else {
                $('#offer').append("<tr><td>"+htmlObj.id+"</td><td>"+htmlObj.name+"</td><td><a href="+link+" target=_blank>"+link+"</a></td></tr>"); 
            }
            });
        }
        
    }

    function genTrack(id) {
          fetch('https://arabclicks.api.hasoffers.com/Apiv3/json?api_key=80367cdcf1809a07a3e0b57ed948af3dea2334c4d22854916cd7398b537c726e&Target=Affiliate_Offer&Method=acceptOfferTermsAndConditions&offer_id='+id)
          .then(res=>{
            fetch('/deeplink/'+id)
            .then(response => response.json())
            .then(data=>{
                 $('#'+id).empty();
                 $('#'+id).append("<a href="+data.data.click_url+">"+data.data.click_url+"</a>");
             });
       })
          
    }
</script>
<body>
    Enter the offer ID. Leave it blank to list all offers <input type="text" id="id">
    <button onclick="fetchOffers()">Send</button>
    <table id="offer">
    <tr><th>Offer ID</th><th>Offer Name</th><th>Tracking Link</th></tr>
    </table>
</body>
</html>